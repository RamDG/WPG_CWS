q=[theta_leg(6,1),theta_leg(5,1),theta_leg(4,1),theta_leg(3,1),theta_leg(2,1),theta_leg(1,1),...
    theta_leg(2:end,2)',theta_arm(:,1)',0,theta_arm(:,2)',0,theta_head'];

% % Lengths from NAO documentation
% FootHeight = 45.19; % V3.2 = 45.11
% TibiaLength = 102.9; % V3.2 = V3.3
% ThighLength = 100; % V3.2 = V3.3
% HipOffsetZ = 85; % V3.2 = V3.3
% HipOffsetY = 50; % V3.2 = V3.3
% ShoulderOffsetZ = 100; % V3.2 = V3.3
% ShoulderOffsetY = 98; % V3.2 = V3.3
% UpperArmLength = 105; % V3.2 = 90
% ElbowOffsetY = 15;% V3.2 = 0
% LowerArmLength = 55.95; % V3.2 = 50.55
% HandOffsetX = 57.75; % V3.2 = 58
% HandOffsetZ = 12.31; 
% NeckOffsetZ = 126.5; % V3.2 = V3.3

% Lengths from NAO documentation
FootHeight = 45.19*10^-3; % V3.2 = 45.11
TibiaLength = 102.9*10^-3; % V3.2 = V3.3
ThighLength = 100*10^-3; % V3.2 = V3.3
HipOffsetZ = 85*10^-3; % V3.2 = V3.3
HipOffsetY = 50*10^-3; % V3.2 = V3.3
ShoulderOffsetZ = 100*10^-3; % V3.2 = V3.3
ShoulderOffsetY = 98*10^-3; % V3.2 = V3.3
UpperArmLength = 105*10^-3; % V3.2 = 90
ElbowOffsetY = 15*10^-3;% V3.2 = 0
LowerArmLength = 55.95*10^-3; % V3.2 = 50.55
HandOffsetX = 57.75*10^-3; % V3.2 = 58
HandOffsetZ = 12.31*10^-3; 
NeckOffsetZ = 126.5*10^-3; % V3.2 = V3.3


% M-DH parameters

a = [0,...
    1,...
    2,...
    3,...
    4,...
    5,...
    6,...
    7,...
    8,...
    9,...
    10,...
    11,...
    12,...
    13,...
    7,...
    15,...
    16,...
    17,...
    18,...
    19,...
    7,...
    21,...
    22,...
    23,...
    24,...
    25,...
    7,...
    27];
sigma = [0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    2,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    2,...
    0,...
    0,...
    0,...
    0,...
    0,...
    2,...
    0,...
    0,...
    0,...
    0,...
    0,...
    2,...
    0,...
    0];
gamma = [-pi/2,...
    0,...
    0,...
    0,...
    0,...
    0,...
    pi/2,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0];
b = [FootHeight,...
    0,...
    0,...
    0,...
    0,...
    0,...
    (HipOffsetY^2+HipOffsetY^2)^(1/2),...
    -(HipOffsetZ-HipOffsetY),...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    ShoulderOffsetZ,...
    0,...
    0,...
    0,...
    0,...
    HandOffsetX,...
    ShoulderOffsetZ,...
    0,...
    0,...
    0,...
    0,...
    HandOffsetX,...
    0,...
    0];
alpha = [-pi/2,...
    pi/2,...
    0,...
    0,...
    -pi/2,...
    pi/2,...
    pi/4,...
    -3*pi/4,...
    -pi/2,...
    pi/2,...
    0,...
    0,...
    -pi/2,...
    pi/2,...
    -pi/2,...
    pi/2,...
    pi/2,...
    -pi/2,...
    pi/2,...
    -pi/2,...
    -pi/2,...
    pi/2,...
    pi/2,...
    -pi/2,...
    pi/2,...
    -pi/2,...
    0,...
    -pi/2];
d = [0,...
    0,...
    TibiaLength,...
    ThighLength,...
    0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    -ThighLength,...
    -TibiaLength,...
    0,...
    0,...
    0,...
    0,...
    -ElbowOffsetY,...
    0,...
    0,...
    0,...
    0,...
    0,...
    ElbowOffsetY,...
    0,...
    0,...
    0,...
    0,...
    0];
theta = [-pi/2-q(1),...
    -q(2),...
    -q(3),...
    -q(4),...
    pi/4-q(5),...
    -q(6),...
    0,...
    -pi/2+q(6),...
    pi/4+q(7),...
    q(8),...
    q(9),...
    q(10),...
    pi/2+q(11),...
    pi/2,...
    q(12),...
    pi/2+q(13),...
    q(14),...
    q(15),...
    q(16),...
    -pi/2,...
    q(17),...
    pi/2+q(18),...
    q(19),...
    q(20),...
    q(21),...
    -pi/2,...
    q(22),...
    -pi/2+q(23)];
r = [0,...
    0,...
    0,...
    0,...
    0,...
    0,...
    HipOffsetZ-HipOffsetY,...
    (HipOffsetY^2+HipOffsetY^2)^(1/2),...
    0,...
    0,...
    0,...
    0,...
    0,...
    -FootHeight,...
    -ShoulderOffsetY,...
    0,...
    UpperArmLength,...
    0,...
    LowerArmLength,...
    -HandOffsetZ,...
    ShoulderOffsetY,...
    0,...
    UpperArmLength,...
    0,...
    LowerArmLength,...
    -HandOffsetZ,...
    NeckOffsetZ,...
    0];

% w.r.t 0
for j = 1:length(a);
    T(:,:,j) = dgmgenstructure(a,gamma,b,alpha,d,theta,r,0,j);
end

chain_leg_R(:,:,1)=T(:,:,6);
chain_leg_R(:,:,2)=T(:,:,5);
chain_leg_R(:,:,3)=T(:,:,4);
chain_leg_R(:,:,4)=T(:,:,3);
chain_leg_R(:,:,5)=T(:,:,2);
chain_leg_R(:,:,6)=T(:,:,1);
chain_leg_R(:,:,7)=eye(4,4);
chain_leg_L=T(:,:,8:14);
chain_arm_R=T(:,:,15:18);
chain_arm_R=cat(3,chain_arm_R,T(:,:,20));
chain_arm_L=T(:,:,21:24);
chain_arm_L=cat(3,chain_arm_L,T(:,:,26));
chain_head=T(:,:,27:28);

T_global=T(:,:,7);
